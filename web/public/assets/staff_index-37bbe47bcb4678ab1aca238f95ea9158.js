function setRoomlist(o){$("#roomlist").empty().append('<div class="span12" id="roomlist_blank">&nbsp;</div>'),o.forEach(function(o){$("#roomlist").append('<button class="span12 btn margin-bottom" onclick="roomclick(\''+o+"')\" id=list"+o+">user"+o+"</button>")})}function addRoom(o){$("#roomlist").append('<button class="span12 btn margin-bottom" onclick="roomclick(\''+o+"')\" id=list"+o+' data-id="'+o+'">user'+o+"</button>")}function setRoomhistory(o,t){$("#msgs").empty().append('<div class="span12" id="roomhistory_blank">&nbsp;</div>'),t.forEach(function(o){var t=0==o.indexOf("debbie:");$("#msgs").append('<div class="span12 msg-row '+(t?"":"right")+'"><span class=" badge">'+o+"</span></div>")})}function addRoommsg(o,t){var s=0==t.indexOf("debbie:");if(o==selected_roomid)$("#roomhistory_blank").after('<div class="span12 msg-row '+(s?"":"right")+'"><span class=" badge">'+t+"</span></div>");else{var i=$("#roomlist");i.find('button[data-id="'+o+'"]').size()<=0&&addRoom(o),i.find('button[data-id="'+o+'"]').append('<span class="badge badge-warning" style="position: relative; left: 50px;">1</span>')}}function roomclick(o){selected_roomid=o,socket.emit("room.fetchhistory",{roomid:o}),$("#roomlist").find('button[data-id="'+o+'"] span.badge').remove()}function sendmsg(){var o=$("#msgtosend").val();socket.emit("room.msgput",{roomid:selected_roomid,msg:o})}var socket=io.connect("http://localhost:8087");socket.emit("app.tologin",{name:"debbie"}),socket.on("app.login",function(o){$("#loginname").find("a").html(o.name),socket.emit("room.fetchlist"),socket.on("room.msg",function(o){addRoommsg(o.roomid,o.msg)}),socket.on("room.list",function(o){setRoomlist(o.roomlist)}),socket.on("room.create",function(o){addRoom(o.roomid),socket.emit("room.msgput",{roomid:o.roomid,msg:"欢迎光临"})}),socket.on("room.history",function(o){setRoomhistory(o.roomid,o.msgs)})});var selected_roomid=null;